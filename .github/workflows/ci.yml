name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: Test on macOS
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v4

    - name: Select Xcode version
      run: sudo xcode-select -s /Applications/Xcode_15.0.app

    - name: Swift version
      run: swift --version

    - name: Build
      run: swift build -v

    - name: Run tests
      run: swift test -v

    - name: Build release
      run: swift build -c release

    - name: Test executable
      run: .build/release/yeet --help

  lint:
    name: SwiftLint
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v4

    - name: SwiftLint
      run: |
        # Install swiftlint if needed
        if ! command -v swiftlint &> /dev/null; then
          brew install swiftlint
        fi
        swiftlint --version || echo "SwiftLint not configured, skipping"
